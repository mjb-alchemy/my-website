---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Meenal Balar â€” illustrations, projects, writing, and reading notes.",
} = Astro.props;

const currentPath = Astro.url.pathname;
const base = import.meta.env.BASE_URL;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | Meenal Balar</title>
    <script is:inline>
      // Apply terminal mode immediately to prevent flash
      if (localStorage.getItem('terminalMode') === 'true') {
        document.documentElement.classList.add('terminal-mode');
      }
    </script>
    <style>
      /* Mobile nav - ensure stacked layout on small screens */
      @media (max-width: 767px) {
        nav .nav-container {
          flex-direction: column !important;
          align-items: flex-start !important;
          gap: 1rem !important;
        }
        nav .nav-container > a {
          width: 100% !important;
        }
        nav .nav-links {
          font-size: 0.875rem !important;
          gap: 0.75rem !important;
          flex-wrap: wrap !important;
          width: 100% !important;
        }
      }

      /* Bouncing animation */
      @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
      }

      .easter-egg {
        animation: bounce 1s ease-in-out infinite;
        cursor: pointer;
        user-select: none;
        transition: filter 0.2s;
      }

      .easter-egg:hover {
        animation-play-state: paused;
        filter: brightness(1.2);
      }

      /* Terminal mode styles */
      .terminal-mode,
      .terminal-mode body {
        --color-bg: #0a0a0a !important;
        --color-bg-alt: #1a1a1a !important;
        --color-text: #00ff00 !important;
        --color-text-muted: #00cc00 !important;
        --color-accent: #00ff00 !important;
        --color-border: #333 !important;
        background-color: #0a0a0a !important;
      }

      .terminal-mode * {
        font-family: 'JetBrains Mono', monospace !important;
      }

      .terminal-mode h1,
      .terminal-mode h2,
      .terminal-mode h3 {
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #00ff00 !important;
      }

      .terminal-mode .font-serif {
        color: #00ff00 !important;
      }

      .terminal-mode a {
        color: #00ff00 !important;
      }

      .terminal-mode a:hover {
        color: #00cc00 !important;
      }

      .terminal-mode .text-text-muted {
        color: #00cc00 !important;
      }

      .terminal-mode .border-border {
        border-color: #333 !important;
      }

      /* Scanline effect */
      .terminal-mode::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.15),
          rgba(0, 0, 0, 0.15) 1px,
          transparent 1px,
          transparent 2px
        );
        z-index: 9999;
      }

      /* Blinking cursor */
      .terminal-mode .terminal-cursor::after {
        content: '_';
        animation: blink 1s step-end infinite;
      }

      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
      }
    </style>
  </head>
  <body class="min-h-screen bg-bg">
    <!-- Bold Navigation -->
    <nav class="px-6 md:px-12 lg:px-16 py-6 border-b border-border">
      <div class="nav-container flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <a href={base} class="font-serif text-2xl font-semibold hover:text-accent transition-colors shrink-0">
          Meenal Balar
        </a>
        <ul class="nav-links flex items-center gap-4 md:gap-8 text-sm md:text-base font-medium flex-wrap">
          <li>
            <a
              href={`${base}sketches`}
              class:list={[
                "hover:text-accent transition-colors duration-300 ease-out",
                { "text-accent": currentPath.includes('/sketches') }
              ]}
            >
              Sketches
            </a>
          </li>
          <li class="relative" id="projects-dropdown">
            <button
              id="projects-toggle"
              class:list={[
                "hover:text-accent transition-colors duration-300 ease-out",
                { "text-accent": currentPath.includes('/projects') }
              ]}
            >
              Projects
            </button>
            <ul id="projects-menu" class="absolute top-full left-0 md:left-auto md:right-0 mt-2 bg-bg border border-border shadow-lg py-2 min-w-[200px] opacity-0 invisible transition-all duration-300 ease-out z-50">
              <li>
                <a href={`${base}projects/magpie`} class="block px-4 py-2 hover:text-accent hover:bg-bg-alt transition-colors duration-300 ease-out">Magpie</a>
              </li>
              <li>
                <a href={`${base}projects/alchemy`} class="block px-4 py-2 hover:text-accent hover:bg-bg-alt transition-colors duration-300 ease-out">Alchemy</a>
              </li>
            </ul>
          </li>
          <li>
            <a
              href={`${base}notes`}
              class:list={[
                "hover:text-accent transition-colors duration-300 ease-out",
                { "text-accent": currentPath.includes('/notes') }
              ]}
            >
              Notes
            </a>
          </li>
          <li>
            <a
              href={`${base}books`}
              class:list={[
                "hover:text-accent transition-colors duration-300 ease-out",
                { "text-accent": currentPath.includes('/books') }
              ]}
            >
              Shelf
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <script is:inline>
      // Projects dropdown - works on both click (mobile) and hover (desktop)
      const projectsDropdown = document.getElementById('projects-dropdown');
      const projectsToggle = document.getElementById('projects-toggle');
      const projectsMenu = document.getElementById('projects-menu');

      function toggleProjectsMenu(e) {
        e.preventDefault();
        e.stopPropagation();
        const isVisible = projectsMenu.classList.contains('opacity-100');
        if (isVisible) {
          projectsMenu.classList.remove('opacity-100', 'visible');
          projectsMenu.classList.add('opacity-0', 'invisible');
        } else {
          projectsMenu.classList.remove('opacity-0', 'invisible');
          projectsMenu.classList.add('opacity-100', 'visible');
        }
      }

      if (projectsToggle && projectsMenu && projectsDropdown) {
        // Click and touch toggle for mobile
        projectsToggle.addEventListener('click', toggleProjectsMenu);
        projectsToggle.addEventListener('touchend', toggleProjectsMenu);

        // Hover for desktop
        projectsDropdown.addEventListener('mouseenter', () => {
          projectsMenu.classList.remove('opacity-0', 'invisible');
          projectsMenu.classList.add('opacity-100', 'visible');
        });

        projectsDropdown.addEventListener('mouseleave', () => {
          projectsMenu.classList.remove('opacity-100', 'visible');
          projectsMenu.classList.add('opacity-0', 'invisible');
        });

        // Close when clicking outside
        document.addEventListener('click', (e) => {
          if (!projectsDropdown.contains(e.target)) {
            projectsMenu.classList.remove('opacity-100', 'visible');
            projectsMenu.classList.add('opacity-0', 'invisible');
          }
        });
      }
    </script>

    <main class="px-6 md:px-12 lg:px-16 pb-24">
      <slot />
    </main>

    <footer class="px-6 md:px-12 lg:px-16 py-8 border-t border-border">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-text-muted">
        <span>Â© 2026 Meenal Balar</span>
        <div class="flex items-center gap-4">
          <a href="mailto:meenal@whyalchemy.com" class="hover:text-accent transition-colors">
            meenal@whyalchemy.com
          </a>
          <button id="easter-egg" class="easter-egg text-xl" title="Enter terminal mode">ðŸ‘¾</button>
        </div>
      </div>
    </footer>

    <script is:inline>
      const easterEgg = document.getElementById('easter-egg');
      let terminalMode = localStorage.getItem('terminalMode') === 'true';

      // Update button state on load
      if (terminalMode) {
        easterEgg.textContent = 'ðŸ“°';
        easterEgg.title = 'Back to editorial mode';
      }

      easterEgg?.addEventListener('click', () => {
        terminalMode = !terminalMode;
        localStorage.setItem('terminalMode', terminalMode);
        document.documentElement.classList.toggle('terminal-mode', terminalMode);

        if (terminalMode) {
          easterEgg.textContent = 'ðŸ“°';
          easterEgg.title = 'Back to editorial mode';
        } else {
          easterEgg.textContent = 'ðŸ‘¾';
          easterEgg.title = 'Enter terminal mode';
        }
      });
    </script>
  </body>
</html>
