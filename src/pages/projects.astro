---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) =>
  b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Projects">
  <header class="pt-12 pb-16 max-w-4xl">
    <span class="text-label mb-4 block">Work</span>
    <h1 class="mb-6">Projects</h1>
    <p class="text-body-lg max-w-xl">
      Things I've built, designed, or helped bring to life.
    </p>
  </header>

  {sortedProjects.length === 0 ? (
    <div class="py-24 text-center">
      <p class="text-text-muted mb-2">No projects yet.</p>
      <p class="text-sm text-text-light">
        Add your first project through the CMS at <code class="bg-bg-alt px-2 py-1">/admin</code>
      </p>
    </div>
  ) : (
    <div class="space-y-16 max-w-4xl">
      {sortedProjects.map(async (project, index) => {
        const { Content } = await project.render();
        return (
          <article class="grid grid-cols-1 md:grid-cols-12 gap-8 items-start">
            <div class="md:col-span-4">
              <span class="text-label block mb-2">
                {project.data.date.toLocaleDateString('en-US', {
                  year: 'numeric'
                })}
              </span>
              <h2 class="text-2xl mb-2">{project.data.title}</h2>
              {project.data.featured && (
                <span class="text-label text-accent">Featured</span>
              )}
            </div>
            <div class="md:col-span-8">
              <p class="text-body-lg mb-6">
                {project.data.description}
              </p>
              <div class="prose mb-6">
                <Content />
              </div>
              {project.data.link && (
                <a
                  href={project.data.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="btn"
                >
                  View project â†’
                </a>
              )}
            </div>
          </article>
        );
      })}
    </div>
  )}
</BaseLayout>
